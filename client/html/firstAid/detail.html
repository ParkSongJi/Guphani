<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <link rel="stylesheet" href="../../css/layout.css" />
    <link rel="stylesheet" href="../../css/mypage.css" />
    <script src="https://uicdn.toast.com/editor/3.0.2/toastui-editor-all.min.js"></script>
    <script src="../../js/layout.js" defer></script>
    <title>응급처치 상세페이지</title>
  </head>
  <body>
    <div id="firstAidView">
        <!-- Header Section -->
        <header data-include-file="../inc/header.html" class="includeJs basic"></header>
        <div class="inner-wrap">
            <div class="con-wrap">
                <main>
                    <h2 class="page-tit"></h2>
                    <h3 class="sub-tit" id="title"></h3>
                    <div class="date" id="date"></div>
                    <div class="content">
                        <div class="youtube" id="player">
                        </div>
                        <div class="txt-wrap">
                            <div id="editorWrap">
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>
    <!-- mypage모달 -->
    <div id="mypage" data-include-file="../inc/mypage.html" class="includeJs"></div>
</body>
<script src="https://www.youtube.com/iframe_api?key=AIzaSyCXufmkwEfXMnHPxoazenWiDdQ_WEW0qIA"></script>
<script>
var herf = window.location.search
var id = herf.split('=')[1]
let link = `https://port-0-guphani-final-1gksli2alpullmg3.sel4.cloudtype.app/admin/firstAid/view?id=${id}`;
// 상세보기 내용 출력
let code; // 전역 변수로 선언
async function fetchData() {
    const response = await fetch(link);
    const data = await response.json();

    document.getElementById('title').innerText = data.title;
    document.getElementById('date').innerText = (data.createdAt).split('T')[0];
    const viewer = toastui.Editor.factory({
        el: document.querySelector('#editorWrap'),
        viewer: true,
        initialValue: data.contents
    });

    if (data.youtube != undefined) {
        code = data.youtube.split('=')[1]; // 전역 변수에 할당
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);


        function onYouTubePlayerAPIReady() {
            player = new YT.Player('player', {
                videoId: code, // 재생할 유튜브 영상 ID
                playerVars: {
                autoplay: false, // 자동 재생 유무
                loop: true, // 반복 재생 유무
                playlist: code // 반복 재생할 유튜브 영상 ID 목록
                },
                events: {
                    // 영상이 준비되었을 때,
                    onReady: function (event) {
                        event.target.mute(); // 음소거!
                    }
                }
            });
        }
        onYouTubePlayerAPIReady()
    } else {
        const youtube = document.querySelector('#player');
        youtube.style.display = 'none';
    }
}
fetchData();
</script>
</html>
